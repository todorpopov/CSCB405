# Нормализация на данните

## Евристични правила при проектиране на релационни бази от данни
- Релационен модел 
    - Единствената и основна структура - отношението.
    - Релационната схема - множество от имена на атрибути, 
    - Схема на базата от данни - съвкупност от релационни схеми. 

- Неформални мерки на качеството при проектиране на релационни схеми
    - Семантика на атрибутите в отношението.
    - Излишество в данните и аномалии при обновяване.
    - Нулеви стойности в кортежите.
    - Фалшиви кортежи.

- ПРАВИЛО1:Проектирайте релационната схема, така че семантиката й да се обяснява лесно. 
    - Моделиране на обекти и връзки в различни отношения.
    - Представяне на единствен тип обект или връзка в едно отношение.
    - Използване на мнемонични (подсещащи) имена на атрибути и релационни схеми.

- Аномалии при обновяване 
    - Свързани са с трите основни операции: въвеждане, изтриване и модифициране.
    - Видове: 
        - Аномалии при въвеждане
        - Аномалии при изтриване
        - Аномалии при модификации
    
    - ПРАВИЛО 2: проектирайте схемата на отношението така, че да няма аномалии при обновяване.

- Нулеви стойности в кортежите
    - Ако голяма част от атрибутите не се отнасят до всички кортежи, те автоматично се запълват от СУБД със специалната стойност Null. 
    - Създават се  проблеми при изпълнение на операцията "съединение" и при прилагането на агрегатни функции.

    - По-сериозен проблем е различното тълкуване на стойностите Null в дадена релация:
        - атрибутът е неприложим за конкретния кортеж;
        - не е известна стойността на атрибута;
        - стойността не е въведена
    - Представянето на стойностите Null еднотипно, скрива различната им семантика.

    - ПРАВИЛО 3: Да се избягва въвеждането на атрибути в релационната схема, чиито стойности са в голямата си част null.

- Фалшиви кортежи
    - Лоши проекти на релационната база водят до грешни резултати при изпълнението на операцията “съединение”.
    - Отделните релационни схеми трябва да се проектират така, че операцията “естествено съединение” да се извършва само чрез  условия за съединение между атрибути, които са главни или чужди ключове. 
    - Не бива в отделните схеми да има еднакви атрибути, които не са ключове.
    - Наличието на еднакви атрибути, които не са ключове в две различни схеми, позволява дефинирането на условие за съединение, а в резултат се получават фалшиви кортежи.

    - ПРАВИЛО 4: Проектирайте схемите, така че при изпълнение на операцията "съединение" да не се получават фалшиви кортежи.

## Функционални зависимости
- Описват връзката между отделните атрибути в дадена релационна схема 
- Свойства: 
    - използват се за задаването на формални мерки относно качеството на релационния проект;
    - използват се при дефинирането на основните нормални форми;
    - представляват ограничения, които се извеждат от значението и връзките между отделните атрибути в релационните схеми.

- Функционалните зависимости произлизат от значението на атрибутите в дадена схема. 
- Дефинират се от проектанта, в зависимост от неговото разбиране за смисъла на атрибутите в схемата. 
- Веднъж определени, функционалните зависимости са валидни за всички отношения. 
- Служат за описване на ограниченията върху атрибутите на схемата, които да са в сила във всеки един момент, независимо от въвежданите данни. 
- Представляват ограничения за цялостност, които СУБД трябва автоматично да проверява, с цел поддържането на непротиворечива база.

- Наличието на функционални зависимости е свойство на релационната схема R, а не на определените от нея отношения. 
- Те се дефинират явно от проектанта на базата, който е запознат със семантиката на атрибутите на схемата. 
- Множеството от функционални зависимости, които са зададени върху R се бележи с F. 
- Обикновено проектантът на базата дефинира онези от тях, които са семантично очевидни.
- Съществуват допълнителни функционални зависимости, които могат да се извеждат от вече определените (аксиоми на Армстронг).
- Решаването на тази задача е практически важно за да могат да се поддържат коректни данни в базата.

## Процесът "нормализация"
- Нормализацията на данните е процес, при който неудовлетворителните ("лошите") релационни схеми се разлагат или декомпозират чрез разбиване на атрибутите и групирането им в по-малки релационни схеми, които притежават желани свойства. 
- Цел - добър проект на схемите, за да се избягнат аномалиите при обновяване на базата и други нежелателни явления, а информацията да се запази. 
- Декомпозирането се провежда без загуба на атрибути.
- По същество то е идентично с операцията “проекция” от релационната алгебра като “запазване на информацията” означава възможност за обратно построяване на изходната схема чрез операцията “съединение”.
- Нормализацията е формален метод за анализ на отношенията. Тя включва множество от правила, чрез които проектираните релационни схеми се подлагат на проверки, за да се установи в коя от нормалните форми се намират. 


- Нормалните форми (normal forms) са условия, които дадена релационна схема трябва да удовлетворява. 
- Създадени са от Код през 1972 г.  -  три нормални форми, които се означават съответно с 1NF, 2NF, 3NF. 
- Третата нормална форма е доразвита от Бойс и е известна под името нормална форма на Бойс-Код – 3NFBC. 
- Всички форми използват понятията функционална зависимост между атрибутите на дадена релационна схема и ключ.
- Тези форми гарантират отсъствието на аномалии при обновяване. 

- Разработени са четвърта и пета нормални форми.
- Четвърта нормална форма използва понятието многостойностни зависимости и забранява наличието на атрибути А, В и С в схемата, такива че за всяка стойност на А да съществуват множество от стойности на В и множество от стойности на С, като тези множества не зависят едно от друго. 
- Многостойностните зависимости са обобщение на функционалните зависимости, т.е. всяка функционална зависимост може да се разглежда като частен случай на многостойностна зависимост. Това прави донякъде необходима четвъртата нормална форма. 

- Пета нормална форма използва понятието “зависимости по съединение” . 
- Понятието “Пета нормална форма” е известно още под името “нормална форма проекция-съединение” (PJ/NF - projection-join normal form) 
- Тя гарантира проект на схемата, при който не могат да се генерират фалшиви кортежи. 
- В теорията е предложена още една нормална форма, наречена нормална форма “домейн-ключ” (domain-key normal form - DKNF), която отчита всички видове зависимости и ограничения за цялостност. 
- Всяка следваща нормална форма е по-рестриктивна от предхождащите я. 

- За практиката имат значение първите три нормални форми.
- Нормалните форми, разглеждани изолирано от други фактори не гарантират добър проект на базата от данни. 
- Не е достатъчно да се провери дали всяка схема е например в трета нормална форма. 
- Процесът на нормализация чрез декомпозиране на схемите трябва да осигури още:
    - Избягване на фалшиви кортежи.
    - Съхранение на функционалните зависимости, т.е. всички те трябва да са представени в някои от получените след нормализирането отношения.

- Цели на процеса “нормализация” 
    - Елиминиране на излишеството в данните.
    - Избягване на аномалии при обновяването.
    - Създаване на проект на базата, който отразява правилно предметната област.
    - Опростена и автоматична проверка на някои от ограниченията за цялостност.

## Първа нормална форма
- Тя е част от формалната дефиниция на отношението и налага следните ограничения:
    - домейните включват само атомарни (неделими) стойности;
    - стойностите на всеки атрибут във всеки кортеж са неделими.
- Първа нормална форма (1NF) забранява множество от стойности, редица от стойности и влагането на релации, т.е. многозначни и сложни атрибути, както и комбинациите им. 
- Единствените стойности на атрибути, които са позволени от 1NF са единични, неделими стойности. Атрибутите в отношенията са прости.

- Защо ни трябва 1NF?
    Данните, произлизащи от различни източници са в табличен вид – например таблица от Excel, но редовете или колоните не са изградени от неделими стойности и често се срещат повтарящи се групи. 
- Подобни таблици подлежат на “нормализиране” или  привеждане до първа нормална форма. За целта е необходимо да се премахнат всички повтарящи се групи.
- Съществуват два основни подхода за премахване на сложните или многостойностни атрибути от таблици с данни:
    - Повторение на данните;
        - Повтарящите се групи се елиминират чрез допълнително въвеждане на данни в празните колони или редове. 
        - Получава се излишество в съхраняваните данни, но получената нова таблица удовлетворява формалната дефиниция за отношение.
        - Подходът е известен с името “сплескване на таблицата” (flattening the table). 
        - В резултат се получава нова таблица, която съдържа единствено атомарни стойности.
    - Разлагане или Декомпозиране.
        - Премахва повтарящите се групи чрез декомпозиция 
        - Получените таблици са в първа нормална форма

## Втора нормална форма
- Релационната схема R е във втора нормална форма, ако всеки атрибут, който не участвува в главния ключ, е пълно функционално зависим от главния ключ на R.

## Трета нормална форма
- Казваме, че релационната схема R e в трета нормална форма, ако е във 2NF и никой от атрибутите, които не участват в главния ключ, не е транзитивно зависим от него.

## За нормалните форми - неформално
- Първа нормална форма - 1NF
    - всички атрибути зависят от ключа.
- Втора нормална форма – 2NF
    - всички атрибути зависят от целия ключ .
- Трета нормална форма – 3NF
    - всички атрибути зависят само и единствено от ключа.
