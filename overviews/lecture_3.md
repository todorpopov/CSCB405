# Релационен Модел

## Основни понятия на релационния модел
- Създаден от Код (IBM Research) 1970

- Основна идея
    - Релация (таблица) - главна структура за моделиране на данните
    - Базата от данни се представя като множество от релации
    - Неформално отношението прилича на таблица със стойности.
    - Отношението съдържа множество от редове.
    - Във всеки ред елементите от данни представят факти за обект или връзка. Във формалния модел редовете се наричат кортежи.
    - Всяка колона е именувана с име, отговарящо на значението на полето с данни. Във формалния модел имената на  колоните  се наричат атрибути.
    - Всеки ред еднозначно се идентифицира от стойността на определена колона или няколко колони – ключ на отношението.

- Формална дефиниция
    - Домейн се нарича произволно множество от неделими стойности - има тип на данните или формат на данните
    - Крайно множество от имена на атрибути се нарича релационна схема
    - Броят на атрибутите се нарича степен на отношението
    - Кортеж се нарича наредено множество от стойности
    - Броят на кортежите се нарича мощност на отношението

- Свойства на отношението
    - Стойностите в кортежа са атомарни - не съществуват сложни атрибути или многостойностни атрибути
    - Всяко отношение носи уникално уме
    - Всеки атрибут носи уникално име в рамките на дадено отношение
    - Стойностите на даде атрибут принадлежат на един и същ домейн
    - Отношението не съдържа идентични кортежи

    - При релационния модел основна и единствена структура за представяне на данните е отношението

## Релационни ограничения
- Ограниченията са условия, които са в сила каквито и данни да съдържа отношението (винаги са валидни)
- Те произлизат от семантиката на предметната област
- На релационния модел са присъщи няколко основни ограничения
    - ограничения върху ключа (key constraints);
    - ограничения за цялостност на обекта (entity integrity constraints);
    - ограничения за цялостност на връзките (referential integrity constraints);
    - ограничения върху домейните (domain constraint);
    - ограничения за идентитет на кортежите (tuple uniqueness constraint).

- Суперключ - подмножество от няколко атрибута, които задно правят unique ключ; има излишество по отношение на изграждащите го атрибути
- Ограничения върху NULL - Not Null
- Ограничения за цялостност на обекта - ключът не може да приема стойности Null
- Ограничения за цялостност на връзките
    - задават се между две отношения
    - изплозват се за поддържането на непротиворечиви данни между кортежите им
    - свързани са с понятието чужд ключ (неформално - чуждият ключ в една таблица е главен на друга)

## Релационни операции
- Операции за обновяване на базата
    - въвеждане на кортеж
    - въвеждане на кортеж
    - актуализиране на кортеж
- Операции за извличане на данни - трудно за изпилзване
    - релационна алгебра
    - релационно смятане
- Използват се
    - езици, ориентирани към трансформация - SQL
    - Графични езици - QBE
- Ограниченията за цялостност не бива да се нарушават
- Може да се наложи групирането на няколко операции за обновяване за да се запази интегритета на базата
- При нарушаване на ограниченията за цялостност СУБД преприема някое от следните действия
    - прекратява операцията, която нарушава ограниченията за цялостност;
    - изпълнява операцията, но предупреждава потребителя за нарушаването на интегритета;
    - изпълнява специална потребителска програма за корекция на грешката;
    - изпълнява допълнителни актуализации, за да бъде зададената операция изпълнена коректно.

- Въвеждане на кортеж (INSERT) - може да наруши всеки вид ограничение - key constraint, entity integrity constraints, referential integrity constraints, domain constraints
- Изтриване на кортеж (DELETE) - може да наруши само referential integrity constraints
    - средства за защита - RESTRICT, CASCADE, SET NULL
- Актуализиране на кортеж (UPDATE) може да наруши
    - ограничения върху домейните и ограничения върху Null стойностите на актуализирания атрибут;
    - произволно друго ограничение в зависимост от това кой атрибут се обновява (дали е ключ или не)!

- Потребителски представи - Views
    - В базата данни се пазят два вида отношения - базови (кортежите им физически се съхраняват в базата), потребителски (виртуално отношение, не се пазят в базата)
    - Съдържанието на потребителската представа се определя като заявка към базата и е динамично
    - Предназначение
        - ограничава достъпа до базата на определени потребители;
        - осигурява по едно и също време персонализиран достъп на отделните потребители до базата;
        - опростява сложни операции върху базовите отношения.
    - Обновяване на потребителски представи
        - всички обновявания на базово отношение незабавно се отразяват във всички представи където това отношение участва;
        - ако потребителската представа се обнови, промените се отразяват в базовите отношения.
    - Ограничения при обновяването на потребителски представи:
        - обновяванията са разрешени само ако в заявката участва едно базово отношение и се използва негов кандидат ключ;
        - забранено е обновяването на няколко базови отношения едновременно;
        - забранено е използването на агрегатни и групиращи функции.

## Релационна алгебра
- Предоставя основното множество от операции за релационния модел. 
- Операциите на релационната алгебра се използват при намирането на оптимална стратегия за изпълнение на SQL заявки към базата. 
- Вход на операция от релационната алгебра са едно или няколко отношения.  
- Операциите се използват за извличане на данни (формулиране на заявки към базата).
- Резултатът от всяка операция е ново отношение -  казва се, че алгебрата е “затворена”, т.е. всички обекти, получени в резултат от някоя операция са отношения. 
- За изпълнението на една заявка са необходими няколко операции – съвкупността от операции образуват израз на релационната алгебра. 
- Представлява процедурен език.

- Множествени операции:
    - обединение (union) – бележи се с ∪;
    - сечение (intersection) – бележи се с ∩ 
    - разлика (difference) – бележи се с −
    - декартово произведение (Cartesian product) – бележи се с Х

- Релационни операции - разработени са специално за релационните бази от данни.:
    - Селекция (select) – бележи се с σ
        - служи за избор на подмножество от кортежи в дадена релация, които удовлетворяват предварително зададено условие (критерий) за търсене. 
        - действието на селекцията представлява по същество, филтриране на кортежите и извеждане само на онези от тях, които удовлетворяват зададеното условие.
        
        - операцията е унарна, т.е. приложима е върху всеки кортеж на единствена релация. С нея не могат да се избират кортежи от няколко различни отношения. 
        - степента на резултатното отношение е равна на степента на изходното отношение R, броя на кортежите му е по-малък или равен на тези от R.
        - операцията е комутативна.
        - Последователност от селекции се комбинира в единствена.
    - Проекция (project) -  бележи се с π
        - служи за избор на определени колони от дадено отношение.

        - елиминират се дублираните кортежи, за да се получи валидно отношение.
        - броят на кортежите в резултата е по-малък или равен на броя на кортежите в изходното отношение, като равенство се постига при указан ключ в списъка.
        - операцията е унарна и не е комутативна.

    - Съединение (join)
        - комбинира свързани помежду си кортежи от две отношения в един кортеж.
        - позволява обработката на връзки между отделните отношения.

        - условието за съединение се дефинира върху атрибути от двете отношения.

        - видове съединение
            - ляво - всичко отляво, плюс съвпадения отдясно
            - дясно - всичко отдясно, плюс съвпадения отляво
            - вътрешно - само съвпадения
            - пълно - всички възможни комбинации
    - Деление (division) – бележи се с ÷

- Множествени операции
    - За сливане на елементи от две множества се прилагат операциите: сечение ∩ , обединение ∪  и разлика −.
    - Двете изходни отношения трябва да са съвместими по обединение (union compatible), т.е.
        - да имат еднакъв брой атрибути;
        - съответните атрибути да приемат стойности от един и същ домейн.

- Декартово произведение (всяко по всяко)
    - Не се изисква отношенията да бъдат съвместими по обединение.
    - Операцията комбинира кортежи от две релации
    - Резултатът е ново отношение с релационна схема Q, която е изградена от m+n атрибути.

- Допълнителни релационни операции
    - Агрегатни функции - SUM, MAXIMUM, MINIMUM, AVERAGE, COUNT. 
    - Групиране.
    - Рекурсивна обвивка.

## Кога СУБД е наистина релационна
- Основно правило: Всяка релационна СУБД трябва да може да управлява базите от данни посредством възможностите на релационния модел.

- Правило 1: Представяне на информацията.
    - Цялата информация в релационната база от данни се представя на логическо ниво и по единствен начин – чрез стойности в таблици.
- Правило 2: Гарантиран достъп.
    - Всяка атомарна стойност в релационната база е логически достижима чрез името на таблицата, стойността на главния ключ и името на колоната.
- Правило 3: Системно третиране на стойностите null.
    - Стойностите null се поддържат от СУБД по системен път, независимо от типовете на данни.
- Правило 4: Динамичен интерактивен каталог.
    - Описанието на данните се представя на логическо ниво по същия начин както и самите данни.
- Правило 5: релационна СУБД трябва да предоставя поне един език, с който да се изразяват:
    - дефинирането на данните;
    - дефинирането на потребителските представи;
    - обработката на данните;
    - ограниченията за цялостност;
    - правата за достъп;
    - границите на транзакциите.
- Правило 6: Обновяване на потребителските представи.
    - Потребителските представи се обновяват от системата.
- Правило 7: Обновяване на данните на високо ниво.
    - Обновяването на данните трябва да може да се извършва на ниво таблица.
- Правило 8: Физическа независимост на данните.
    - При промяна на методите за достъп или представянето в паметта приложните програми не се променят логически.
- Правило 9: Логическа независимост на данните.
    - При промяна в таблиците, наложена от разработването на нови приложения, старите приложения не се променят логически.
- Правило 10: Независимост на ограниченията за цялостност.
    - Ограниченията за цялостност се задават с езика за заявки и се съхраняват в каталога, а не в приложните програми.
- Правило 11: Независимост на разпределението.
    - Приложната програма, която се обръща към дадена СУБД трябва да работи и при разпределение на базата по възлите на мрежа.
- Правило 12: Защита от подривна дейност.
    - Достъпът до базата се контролира изцяло от СУБД и нейната цялостност не може да бъде нарушена без знанието на администратора или потребителя.
